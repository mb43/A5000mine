<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A5000mine - Unified Mining Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4ade80, #3b82f6, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: rgba(255,255,255,0.7);
            font-size: 1.1em;
        }

        /* Income Projections - Featured Section */
        .income-section {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(16, 185, 129, 0.3);
            border: 2px solid rgba(255,255,255,0.2);
        }

        .income-section h2 {
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
        }

        .income-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .income-card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .income-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .income-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #fff;
        }

        .income-currency {
            font-size: 0.6em;
            opacity: 0.8;
        }

        /* Operations Grid */
        .operations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .operation-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.2s;
        }

        .operation-card:hover {
            transform: translateY(-5px);
        }

        .operation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .operation-title {
            font-size: 1.5em;
            font-weight: bold;
        }

        .operation-type {
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-online {
            background-color: #4ade80;
            box-shadow: 0 0 15px #4ade80;
        }

        .status-offline {
            background-color: #ef4444;
            box-shadow: 0 0 15px #ef4444;
            animation: none;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: rgba(255,255,255,0.8);
            font-size: 0.95em;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.1em;
        }

        .hashrate-display {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            padding: 15px 0;
            color: #4ade80;
            text-shadow: 0 0 20px rgba(74, 222, 128, 0.5);
        }

        /* Miners Grid (for ASIC operations) */
        .miners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .miner-mini {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .miner-mini.online {
            border-color: #4ade80;
        }

        .miner-mini.offline {
            border-color: #ef4444;
            opacity: 0.6;
        }

        .miner-name {
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .miner-hashrate {
            font-size: 1.2em;
            font-weight: bold;
            color: #4ade80;
        }

        /* GPU Stats */
        .gpu-card {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .gpu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .gpu-stat {
            text-align: center;
        }

        .gpu-stat-label {
            font-size: 0.8em;
            opacity: 0.8;
        }

        .gpu-stat-value {
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 5px;
        }

        /* Income by Operation Table */
        .income-breakdown {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .income-breakdown table {
            width: 100%;
            border-collapse: collapse;
        }

        .income-breakdown th,
        .income-breakdown td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .income-breakdown th {
            background: rgba(255,255,255,0.1);
            font-weight: bold;
        }

        .income-breakdown tr:last-child td {
            border-bottom: none;
        }

        .income-breakdown .total-row {
            background: rgba(16, 185, 129, 0.2);
            font-weight: bold;
            font-size: 1.1em;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: rgba(255,255,255,0.5);
            font-size: 0.9em;
            margin-top: 30px;
        }

        .refresh-info {
            text-align: center;
            color: rgba(255,255,255,0.5);
            font-size: 0.85em;
            margin-top: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: rgba(255,255,255,0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚õèÔ∏è A5000mine - Unified Mining Dashboard</h1>
            <p class="subtitle">Multi-Operation Mining Monitor: GPU & ASIC</p>
        </header>

        <!-- Income Projections Section -->
        <div class="income-section">
            <h2>üí∞ Income Projections</h2>
            <div class="income-grid">
                <div class="income-card">
                    <div class="income-label">Daily Income</div>
                    <div class="income-value">¬£<span id="income-daily">0.00</span></div>
                </div>
                <div class="income-card">
                    <div class="income-label">Monthly Income</div>
                    <div class="income-value">¬£<span id="income-monthly">0.00</span></div>
                </div>
                <div class="income-card">
                    <div class="income-label">Yearly Income</div>
                    <div class="income-value">¬£<span id="income-yearly">0.00</span></div>
                </div>
            </div>

            <div class="income-breakdown">
                <table id="income-table">
                    <thead>
                        <tr>
                            <th>Operation</th>
                            <th>Units</th>
                            <th>Daily (¬£)</th>
                            <th>Monthly (¬£)</th>
                            <th>Yearly (¬£)</th>
                        </tr>
                    </thead>
                    <tbody id="income-tbody">
                        <tr><td colspan="5" class="loading">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Operations Grid -->
        <div id="operations-container" class="operations-grid">
            <div class="loading">Loading mining operations...</div>
        </div>

        <div class="refresh-info">
            Auto-refreshing every 5 seconds | Last update: <span id="last-update">-</span>
        </div>

        <footer>
            <p>A5000mine Unified Dashboard | Multi-Operation Mining System</p>
        </footer>
    </div>

    <script>
        let refreshInterval;

        function formatUptime(seconds) {
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const mins = Math.floor((seconds % 3600) / 60);

            if (days > 0) return `${days}d ${hours}h ${mins}m`;
            if (hours > 0) return `${hours}h ${mins}m`;
            return `${mins}m`;
        }

        function renderAeternityOperation(op) {
            const active = op.mining_active || false;
            const gpus = op.gpu_stats || [];
            const stats = op.miner_stats || {};

            let gpuHtml = '';
            gpus.forEach(gpu => {
                gpuHtml += `
                    <div class="gpu-card">
                        <strong>${gpu.name} (GPU ${gpu.index})</strong>
                        <div class="gpu-grid">
                            <div class="gpu-stat">
                                <div class="gpu-stat-label">Temp</div>
                                <div class="gpu-stat-value">${gpu.temperature}¬∞C</div>
                            </div>
                            <div class="gpu-stat">
                                <div class="gpu-stat-label">Power</div>
                                <div class="gpu-stat-value">${gpu.power_draw}W</div>
                            </div>
                            <div class="gpu-stat">
                                <div class="gpu-stat-label">Utilization</div>
                                <div class="gpu-stat-value">${gpu.utilization}%</div>
                            </div>
                            <div class="gpu-stat">
                                <div class="gpu-stat-label">Memory</div>
                                <div class="gpu-stat-value">${gpu.memory_used}MB</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            return `
                <div class="operation-card">
                    <div class="operation-header">
                        <div class="operation-title">
                            <span class="status-indicator ${active ? 'status-online' : 'status-offline'}"></span>
                            Aeternity
                        </div>
                        <div class="operation-type">GPU</div>
                    </div>

                    <div class="hashrate-display">${stats.hashrate || 0} G/s</div>

                    <div class="stat-row">
                        <span class="stat-label">Status</span>
                        <span class="stat-value">${active ? 'Mining' : 'Offline'}</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">GPUs Active</span>
                        <span class="stat-value">${gpus.length}</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Accepted Shares</span>
                        <span class="stat-value">${stats.shares_accepted || 0}</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Rejected Shares</span>
                        <span class="stat-value">${stats.shares_rejected || 0}</span>
                    </div>

                    ${gpuHtml}
                </div>
            `;
        }

        function renderKaspaOperation(op) {
            const miners = op.miners_status || [];
            const onlineCount = miners.filter(m => m.online).length;
            const totalHashrate = miners.filter(m => m.online).reduce((sum, m) => sum + m.hashrate, 0);

            let minersHtml = '';
            if (miners.length > 0) {
                minersHtml = '<div class="miners-grid">';
                miners.forEach(miner => {
                    minersHtml += `
                        <div class="miner-mini ${miner.online ? 'online' : 'offline'}">
                            <div class="miner-name">${miner.name}</div>
                            <div class="status-indicator ${miner.online ? 'status-online' : 'status-offline'}"></div>
                            <div class="miner-hashrate">${miner.online ? miner.hashrate + ' TH/s' : 'Offline'}</div>
                        </div>
                    `;
                });
                minersHtml += '</div>';
            }

            return `
                <div class="operation-card">
                    <div class="operation-header">
                        <div class="operation-title">
                            <span class="status-indicator ${onlineCount > 0 ? 'status-online' : 'status-offline'}"></span>
                            Kaspa
                        </div>
                        <div class="operation-type">ASIC</div>
                    </div>

                    <div class="hashrate-display">${totalHashrate.toFixed(1)} TH/s</div>

                    <div class="stat-row">
                        <span class="stat-label">Status</span>
                        <span class="stat-value">${onlineCount > 0 ? 'Mining' : 'Offline'}</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Miners Online</span>
                        <span class="stat-value">${onlineCount} / ${miners.length}</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Model</span>
                        <span class="stat-value">KS5M</span>
                    </div>

                    ${minersHtml}
                </div>
            `;
        }

        function renderZcashOperation(op) {
            const miners = op.miners_status || [];
            const onlineCount = miners.filter(m => m.online).length;

            return `
                <div class="operation-card" style="opacity: 0.6;">
                    <div class="operation-header">
                        <div class="operation-title">
                            <span class="status-indicator status-offline"></span>
                            Zcash
                        </div>
                        <div class="operation-type">ASIC</div>
                    </div>

                    <div class="stat-row">
                        <span class="stat-label">Status</span>
                        <span class="stat-value">Not Configured</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Coming Soon</span>
                        <span class="stat-value">Z15 Pro</span>
                    </div>
                </div>
            `;
        }

        function updateDashboard() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    // Update income projections
                    const income = data.income_projections.total;
                    document.getElementById('income-daily').textContent = income.daily_gbp.toFixed(2);
                    document.getElementById('income-monthly').textContent = income.monthly_gbp.toFixed(2);
                    document.getElementById('income-yearly').textContent = income.yearly_gbp.toLocaleString('en-GB', {minimumFractionDigits: 2, maximumFractionDigits: 2});

                    // Update income breakdown table
                    const tbody = document.getElementById('income-tbody');
                    tbody.innerHTML = '';

                    data.income_projections.by_operation.forEach(op => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${op.operation}</td>
                            <td>${op.units}</td>
                            <td>¬£${op.daily_gbp.toFixed(2)}</td>
                            <td>¬£${op.monthly_gbp.toFixed(2)}</td>
                            <td>¬£${op.yearly_gbp.toLocaleString('en-GB', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                        `;
                        if (!op.active) {
                            row.style.opacity = '0.5';
                        }
                    });

                    // Add total row
                    const totalRow = tbody.insertRow();
                    totalRow.className = 'total-row';
                    totalRow.innerHTML = `
                        <td><strong>TOTAL</strong></td>
                        <td>-</td>
                        <td><strong>¬£${income.daily_gbp.toFixed(2)}</strong></td>
                        <td><strong>¬£${income.monthly_gbp.toFixed(2)}</strong></td>
                        <td><strong>¬£${income.yearly_gbp.toLocaleString('en-GB', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></td>
                    `;

                    // Render operations
                    const container = document.getElementById('operations-container');
                    container.innerHTML = '';

                    data.operations.forEach(op => {
                        let html = '';
                        if (op.name === 'aeternity') {
                            html = renderAeternityOperation(op);
                        } else if (op.name === 'kaspa') {
                            html = renderKaspaOperation(op);
                        } else if (op.name === 'zcash') {
                            html = renderZcashOperation(op);
                        }
                        container.innerHTML += html;
                    });

                    // Update timestamp
                    document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
                })
                .catch(error => {
                    console.error('Error fetching status:', error);
                    document.getElementById('operations-container').innerHTML =
                        '<div class="loading">Error loading data. Retrying...</div>';
                });
        }

        // Initial load
        updateDashboard();

        // Auto-refresh every 5 seconds
        refreshInterval = setInterval(updateDashboard, 5000);
    </script>
</body>
</html>
